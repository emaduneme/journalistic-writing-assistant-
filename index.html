<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Check: Journalistic Writing Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Libraries for File Handling -->
    <!-- PDF Reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;</script>
    <!-- DOCX Reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.18/mammoth.browser.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .report-card, .choice-card {
            transition: all 0.3s ease-in-out;
        }
        .report-card:hover, .choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .feedback-list li {
            position: relative;
            padding-left: 1.5rem;
        }
        .feedback-list li::before {
            content: 'â€¢';
            position: absolute;
            left: 0;
            color: #4f46e5;
        }
        #spinner {
            border: 4px solid rgba(0, 0, 0, .1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Custom file input */
        #file-upload-label {
            cursor: pointer;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div class="container mx-auto px-4 py-8 md:py-12">
        <!-- Header Section -->
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">News Check</h1>
            <p id="subtitle" class="mt-2 text-lg text-gray-600">Your Journalistic Writing Assistant</p>
        </header>

        <!-- Selection Screen -->
        <section id="selection-screen" class="max-w-2xl mx-auto">
            <h2 class="text-2xl font-bold text-center mb-6">What type of article are you writing?</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- News Story Choice -->
                <div id="select-news" class="choice-card bg-white p-8 rounded-2xl shadow-lg text-center cursor-pointer">
                    <svg class="w-16 h-16 mx-auto text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 18V6.375c0-.621.504-1.125 1.125-1.125H9.75" /></svg>
                    <h3 class="text-2xl font-bold mt-4">News Story</h3>
                    <p class="text-gray-600 mt-2">For hard news, press releases, and fact-based reporting.</p>
                </div>
                <!-- Feature Story Choice -->
                <div id="select-feature" class="choice-card bg-white p-8 rounded-2xl shadow-lg text-center cursor-pointer">
                     <svg class="w-16 h-16 mx-auto text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L10.582 16.07a4.5 4.5 0 01-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 011.13-1.897l8.932-8.931zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0115.75 21H5.25A2.25 2.25 0 013 18.75V8.25A2.25 2.25 0 015.25 6H10" /></svg>
                    <h3 class="text-2xl font-bold mt-4">Feature Story</h3>
                    <p class="text-gray-600 mt-2">For profiles, narrative pieces, and creative storytelling.</p>
                </div>
            </div>
        </section>

        <!-- Analyzer Screen -->
        <main id="analyzer-screen" class="max-w-4xl mx-auto hidden">
            <button id="back-btn" class="mb-4 inline-flex items-center text-indigo-600 hover:text-indigo-800 font-semibold">
                <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" /></svg>
                Back to Story Types
            </button>
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <!-- File Upload -->
                <div class="mb-4">
                    <label id="file-upload-label" for="file-upload" class="w-full inline-flex items-center justify-center px-4 py-3 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-indigo-500 hover:text-indigo-600 transition">
                        <svg class="w-6 h-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 16.5V9.75m0 0l3 3m-3-3l-3 3M6.75 19.5a4.5 4.5 0 01-1.41-8.775 5.25 5.25 0 0110.233-2.33 3 3 0 013.758 3.848A3.752 3.752 0 0118 19.5H6.75z" /></svg>
                        Upload a .txt, .docx, or .pdf file
                    </label>
                    <input id="file-upload" type="file" class="hidden" accept=".txt,.docx,.pdf">
                    <p id="file-name" class="text-sm text-center mt-2 text-gray-500"></p>
                </div>
                <div class="relative my-4">
                    <div class="absolute inset-0 flex items-center"><span class="w-full border-t"></span></div>
                    <div class="relative flex justify-center text-xs uppercase"><span class="bg-white px-2 text-gray-500">Or paste text below</span></div>
                </div>
                <!-- Text Area -->
                <textarea id="text-input" rows="15" class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="Start writing or paste your text here..."></textarea>
                <div class="mt-4 text-center">
                    <button id="analyze-btn" class="bg-indigo-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-transform transform hover:scale-105 inline-flex items-center">
                        <svg class="w-5 h-5 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 11-3 0m3 0a1.5 1.5 0 10-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 01-3 0m3 0a1.5 1.5 0 00-3 0m-9.75 0h9.75" /></svg>
                        Analyze Text
                    </button>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="spinner-container" class="text-center py-8 hidden">
                 <div id="spinner" class="mx-auto"></div>
                 <p class="mt-2 text-gray-600">Analyzing your text...</p>
            </div>

            <!-- Report Section -->
            <div id="report-section" class="mt-10 hidden">
                <h2 class="text-3xl font-bold text-center mb-8">Analysis Report</h2>
                <div id="report-grid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Cards will be dynamically inserted here -->
                    <!-- AP Style Card -->
                    <div id="ap-style-card" class="bg-white p-6 rounded-2xl shadow-md report-card"></div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- STATE ---
        let currentStoryType = null;

        // --- DOM Elements ---
        const selectionScreen = document.getElementById('selection-screen');
        const analyzerScreen = document.getElementById('analyzer-screen');
        const selectNewsBtn = document.getElementById('select-news');
        const selectFeatureBtn = document.getElementById('select-feature');
        const backBtn = document.getElementById('back-btn');
        const analyzeBtn = document.getElementById('analyze-btn');
        const fileUpload = document.getElementById('file-upload');
        const fileNameDisplay = document.getElementById('file-name');
        const textInput = document.getElementById('text-input');
        const reportSection = document.getElementById('report-section');
        const reportGrid = document.getElementById('report-grid');
        const spinnerContainer = document.getElementById('spinner-container');
        const subtitle = document.getElementById('subtitle');
        const apStyleCard = document.getElementById('ap-style-card');

        // --- Event Listeners ---
        selectNewsBtn.addEventListener('click', () => showAnalyzer('news'));
        selectFeatureBtn.addEventListener('click', () => showAnalyzer('feature'));
        backBtn.addEventListener('click', showSelectionScreen);
        fileUpload.addEventListener('change', handleFileUpload);
        analyzeBtn.addEventListener('click', handleAnalysis);

        // --- UI Control Functions ---
        function showAnalyzer(type) {
            currentStoryType = type;
            selectionScreen.style.display = 'none';
            analyzerScreen.style.display = 'block';
            subtitle.textContent = `Analyzing a ${type === 'news' ? 'News Story' : 'Feature Story'}`;
            textInput.value = '';
            fileNameDisplay.textContent = '';
            fileUpload.value = '';
            reportSection.style.display = 'none';
        }

        function showSelectionScreen() {
            analyzerScreen.style.display = 'none';
            selectionScreen.style.display = 'block';
            subtitle.textContent = 'Your Journalistic Writing Assistant';
        }

        // --- File Upload Handling ---
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            fileNameDisplay.textContent = `Uploading: ${file.name}`;
            const reader = new FileReader();

            if (file.type === "text/plain") {
                reader.onload = (e) => { textInput.value = e.target.result; fileNameDisplay.textContent = `Loaded: ${file.name}`; };
                reader.readAsText(file);
            } else if (file.name.endsWith('.docx')) {
                reader.onload = (e) => {
                    mammoth.extractRawText({ arrayBuffer: e.target.result })
                        .then(result => { textInput.value = result.value; fileNameDisplay.textContent = `Loaded: ${file.name}`; })
                        .catch(err => { alert('Error reading DOCX file.'); console.error(err); fileNameDisplay.textContent = 'Error.'; });
                };
                reader.readAsArrayBuffer(file);
            } else if (file.type === "application/pdf") {
                reader.onload = (e) => {
                    const loadingTask = pdfjsLib.getDocument(e.target.result);
                    loadingTask.promise.then(pdf => {
                        let fullText = '';
                        const numPages = pdf.numPages;
                        let pagePromises = [];
                        for (let i = 1; i <= numPages; i++) {
                            pagePromises.push(pdf.getPage(i).then(page => {
                                return page.getTextContent().then(textContent => {
                                    return textContent.items.map(item => item.str).join(' ');
                                });
                            }));
                        }
                        Promise.all(pagePromises).then(pageTexts => {
                            textInput.value = pageTexts.join('\n\n');
                            fileNameDisplay.textContent = `Loaded: ${file.name}`;
                        });
                    }).catch(err => { alert('Error reading PDF file.'); console.error(err); fileNameDisplay.textContent = 'Error.'; });
                };
                reader.readAsArrayBuffer(file);
            } else {
                alert("Unsupported file type. Please upload .txt, .docx, or .pdf");
                fileNameDisplay.textContent = '';
            }
        }

        // --- Main Analysis Logic ---
        function handleAnalysis() {
            const text = textInput.value;
            if (text.trim() === '') {
                alert('Please enter some text to analyze.');
                return;
            }
            spinnerContainer.style.display = 'block';
            reportSection.style.display = 'none';
            analyzeBtn.disabled = true;
            analyzeBtn.classList.add('opacity-50', 'cursor-not-allowed');

            setTimeout(() => {
                runAnalysis(text);
                spinnerContainer.style.display = 'none';
                reportSection.style.display = 'block';
                window.scrollTo({ top: reportSection.offsetTop, behavior: 'smooth' });
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, 1000);
        }

        function runAnalysis(text) {
            reportGrid.innerHTML = ''; 
            
            const reports = [
                checkReadability(text),
                checkGrammarAndStyle(text),
                checkBias(text),
                checkAPStyle(text)
            ];

            if (currentStoryType === 'news') {
                reports.push(checkFiveWs(text));
                reports.push(checkBuriedLede(text));
            } else if (currentStoryType === 'feature') {
                reports.push(checkFeatureLede(text));
                reports.push(checkNutGraf(text));
            }
            
            reports.forEach(report => renderCard(report));
        }

        function renderCard(reportData) {
            const cardElement = document.createElement('div');
            cardElement.className = `bg-white p-6 rounded-2xl shadow-md report-card ${reportData.fullWidth ? 'md:col-span-2' : ''}`;
            let feedbackHTML = reportData.feedback.length > 0 ? `<ul class="mt-4 space-y-2 text-gray-600 feedback-list">${reportData.feedback.map(item => `<li>${item}</li>`).join('')}</ul>` : '';
            cardElement.innerHTML = `<div class="flex items-center">${reportData.icon}<h3 class="text-xl font-semibold ml-3">${reportData.title}</h3></div><p class="mt-2 text-2xl font-bold ${reportData.color}">${reportData.score}</p><div class="mt-4 text-sm"><p class="font-medium text-gray-700">${reportData.summary}</p>${feedbackHTML}</div>`;
            reportGrid.appendChild(cardElement);
        }
        
        // --- Analysis Modules (Functions like checkReadability, etc.) ---
        function checkReadability(text) {
            const words = text.match(/\b\w+\b/g) || [];
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
            if (words.length < 10 || sentences.length < 1) { return { title: "Readability", icon: `<svg class="w-8 h-8 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>`, score: "Not Enough Text", color: "text-gray-500", summary: "Please provide more text for an accurate readability score.", feedback: [] }; }
            let syllableCount = 0;
            words.forEach(word => { syllableCount += countSyllables(word); });
            const gradeLevel = (0.39 * (words.length / sentences.length)) + (11.8 * (syllableCount / words.length)) - 15.59;
            const score = `Grade ${Math.round(gradeLevel)}`;
            let summary, color, feedback = [];
            if (gradeLevel <= 8) { summary = "Highly readable and accessible to a broad audience."; color = "text-green-600"; } 
            else if (gradeLevel <= 12) { summary = "Clear for most readers, but could be simplified."; color = "text-yellow-600"; feedback.push("Try breaking down longer sentences or replacing complex words."); } 
            else { summary = "Complex. This may be difficult for a general audience to understand."; color = "text-red-600"; feedback.push("Your sentences or words might be too long. Aim for clarity."); }
            return { title: "Readability", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" /></svg>`, score: score, color: color, summary: summary, feedback: feedback };
        }
        function countSyllables(word) { word = word.toLowerCase(); if (word.length <= 3) return 1; word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '').replace(/^y/, ''); const m = word.match(/[aeiouy]{1,2}/g); return m ? m.length : 0; }
        function checkGrammarAndStyle(text) {
            let feedback = [];
            const passives = text.match(/\b(am|are|is|was|were|be|being|been)\b\s*(\w+ed|[\w]+en)\b/gi);
            if (passives && passives.length > 2) { feedback.push(`Found ${passives.length} potential uses of passive voice (e.g., "${passives[0]}"). <strong>Example:</strong> Instead of "The bill was passed," write "The Senate passed the bill."`); }
            const weakWords = ['very', 'really', 'just', 'basically', 'actually', 'quite', 'somewhat'];
            let foundWeakWords = [];
            weakWords.forEach(word => { if (new RegExp(`\\b${word}\\b`, 'gi').test(text)) { foundWeakWords.push(word); } });
            if (foundWeakWords.length > 0) { feedback.push(`Consider removing weak words like: <strong>${foundWeakWords.join(', ')}</strong>.`); }
            let score = "No Issues Found"; let color = "text-green-600";
            if (feedback.length > 0) { score = "Needs Review"; color = "text-yellow-600"; }
            if (feedback.length > 2) { score = "Needs Improvement"; color = "text-red-600"; }
            return { title: "Grammar & Style", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M16.862 4.487l1.687-1.688a1.875 1.875 0 112.652 2.652L6.832 19.82a4.5 4.5 0 01-1.897 1.13l-2.685.8.8-2.685a4.5 4.5 0 011.13-1.897L16.863 4.487zm0 0L19.5 7.125" /></svg>`, score: score, color: color, summary: "Checks for passive voice and weak words.", feedback: feedback };
        }
        function checkBias(text) {
            let feedback = [];
            const loadedWords = ['amazing', 'shocking', 'tragic', 'miracle', 'obviously', 'clearly', 'groundbreaking', 'revolutionary', 'state-of-the-art', 'best', 'worst', 'so-called', 'controversial', 'refused', 'admitted', 'iconic', 'legendary', 'unprecedented', 'claimed'];
            let foundLoadedWords = [];
            loadedWords.forEach(word => { if (new RegExp(`\\b${word}\\b`, 'gi').test(text)) { foundLoadedWords.push(word); } });
            if (foundLoadedWords.length > 0) { feedback.push(`Subjective or promotional words were found: <strong>${foundLoadedWords.join(', ')}</strong>. <strong>Example:</strong> Instead of "a tragic accident," describe the facts.`); }
            let score = "Low Bias"; let color = "text-green-600";
            if (feedback.length > 0) { score = "Potential Bias"; color = "text-yellow-600"; }
            return { title: "Bias Check", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0012 4.5c-2.291 0-4.545.16-6.75.47m13.5 0c1.01.143 2.01.317 3 .52m-3-.52l2.62 10.726c.122.499-.106 1.028-.589 1.202a5.988 5.988 0 01-2.153.34c-1.325 0-2.59-.383-3.628-1.035a21.44 21.44 0 00-4.252-2.324m13.5 0l-2.62 10.726m0 0l-2.62-10.726" /></svg>`, score: score, color: color, summary: "Checks for loaded adjectives and promotional language.", feedback: feedback };
        }
        function checkAPStyle(text) {
            let feedback = [];
            if (text.match(/\b([0-9])\b/g)) { feedback.push(`Found single digits written as numerals. AP Style spells out numbers one through nine.`); }
            if (/\b(Over)\b/g.test(text)) { feedback.push(`Found the word "Over." In AP Style, use "more than" for numerical values.`); }
            if (/\b(Internet)\b/g.test(text)) { feedback.push(`Found "Internet" capitalized. AP Style lowercases this word.`); }
            let score = "No Issues Found"; let color = "text-green-600";
            if (feedback.length > 0) { score = "Needs Review"; color = "text-yellow-600"; }
            return { title: "AP Style Quick Check", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`, score: score, color: color, summary: "Checks for a few common AP Stylebook rules.", feedback: feedback };
        }
        function checkFiveWs(text) {
            const firstParagraphs = text.split('\n').slice(0, 3).join(' '); let feedback = []; let foundCount = 0;
            const checks = { 'Who': /\b(mr|mrs|ms|dr|[A-Z][a-z]+ [A-Z][a-z]+)\b/, 'What': /\b(announced|said|reported|discovered|crashed|won|lost)\b/i, 'When': /\b(monday|tuesday|today|yesterday|\d{1,2}:\d{2})\b/i, 'Where': /\b(at|in|on)\s(the\s)?[A-Z][a-z]+\b/, 'Why/How': /\b(because|due to|as a result of)\b/i };
            for (const [key, regex] of Object.entries(checks)) { if (regex.test(firstParagraphs)) foundCount++; else feedback.push(`The <strong>'${key}'</strong> of the story is not immediately clear.`); }
            let score = `${foundCount}/5 W's Found`; let color = "text-green-600"; if (foundCount < 5) color = "text-yellow-600"; if (foundCount < 3) color = "text-red-600";
            return { title: "Missing Information (5Ws)", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607zM10.5 7.5v6m3-3h-6" /></svg>`, score: score, color: color, summary: "A good news lead should answer Who, What, When, Where, and Why/How.", feedback: feedback };
        }
        function checkBuriedLede(text) {
            const sentences = text.match(/[^.!?]+[.!?]+/g) || [];
            if (sentences.length < 3) { return { title: "Buried Lede", icon: `<svg class="w-8 h-8 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3" /></svg>`, score: "Not Enough Text", color: "text-gray-500", summary: "More text is needed to check this.", feedback: [], fullWidth: true }; }
            const getSentenceScore = (s) => (/\b(announced|said|reported|discovered|crashed|won|lost)\b/i.test(s) ? 3 : 0) + (/\b[A-Z][a-z]+ [A-Z][a-z]+\b/.test(s) ? 2 : 0) + (/\b(yesterday|today|monday)\b/i.test(s) ? 1 : 0);
            const firstSentenceScore = getSentenceScore(sentences[0]); let potentialLedeSentence = null; let highestScore = firstSentenceScore;
            for (let i = 1; i < Math.min(sentences.length, 4); i++) { let currentScore = getSentenceScore(sentences[i]); if (currentScore > highestScore + 1) { highestScore = currentScore; potentialLedeSentence = sentences[i]; } }
            let feedback = []; let score = "Lede is Clear"; let color = "text-green-600"; let summary = "The most important information appears to be at the top.";
            if (potentialLedeSentence) { score = "Potential Buried Lede"; color = "text-red-600"; summary = "The first sentence might not contain the most critical information."; feedback.push(`This later sentence seems more direct: "<em>${potentialLedeSentence.trim()}</em>"`); feedback.push("<strong>Example:</strong> Ensure the most newsworthy element is in your very first sentence."); }
            return { title: "Buried Lede", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 13.5L12 21m0 0l-7.5-7.5M12 21V3" /></svg>`, score: score, color: color, summary: summary, feedback: feedback, fullWidth: true };
        }
        function checkFeatureLede(text) {
            const firstParagraph = (text.split('\n')[0] || "").trim(); let feedback = [];
            let score = "Engaging Lede"; let color = "text-green-600"; let summary = "The opening is descriptive and appropriate for a feature story.";
            const adjectives = firstParagraph.match(/\b\w+ly\b|\b(red|blue|large|small|beautiful|dark|bright)\b/gi) || [];
            if (firstParagraph.length < 100 && adjectives.length === 0) { score = "Potentially Weak Lede"; color = "text-yellow-600"; summary = "The lede is very direct. Feature ledes can be more creative."; feedback.push("Consider adding more descriptive language, setting a scene, or introducing a character to draw the reader in."); }
            return { title: "Feature Lede", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M11.42 15.17L17.25 21A2.652 2.652 0 0021 17.25l-5.877-5.877M11.42 15.17l2.496-3.03c.317-.384.74-.626 1.208-.766M11.42 15.17l-4.655 5.653a2.548 2.548 0 11-3.586-3.586l6.837-5.63m5.108-.233c.55-.164 1.163-.188 1.743-.14a4.5 4.5 0 004.486-6.336l-3.276 3.277a3.004 3.004 0 01-4.243-4.243l3.275-3.275a4.5 4.5 0 00-6.336 4.486c.046.58.106 1.193.14 1.743m-2.108-5.842a3.004 3.004 0 00-4.243-4.243L6.837 4.99m6.408 6.408l-4.243 4.243" /></svg>`, score: score, color: color, summary: summary, feedback: feedback };
        }
        function checkNutGraf(text) {
            const paragraphs = text.split(/\n+/); let feedback = []; let foundNutGraf = false;
            const nutGrafKeywords = /\b(issue is|at its heart|the reason|what this means|this story is about|the focus is)\b/i;
            for (let i = 1; i < Math.min(paragraphs.length, 4); i++) { if (nutGrafKeywords.test(paragraphs[i])) { foundNutGraf = true; break; } }
            let score = "Nut Graf Detected"; let color = "text-green-600"; let summary = "A paragraph explaining the story's significance appears to be present.";
            if (!foundNutGraf) { score = "Nut Graf Missing"; color = "text-red-600"; summary = "Could not find a clear 'nut graf' that summarizes the story's purpose."; feedback.push("A nut graf is a paragraph that tells the reader what the story is about and why they should care. It usually appears after the creative lede."); feedback.push("<strong>Example Nut Graf:</strong> <em>'The controversial decision affects more than 1,200 registered dog owners in Springfield and comes after three months of heated public debate over the park's future. The closure will force pet owners to drive to neighboring towns for off-leash exercise options.'</em> This paragraph clearly explains the stakes and context."); }
            return { title: "Nut Graf Check", icon: `<svg class="w-8 h-8 text-indigo-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" /></svg>`, score: score, color: color, summary: summary, feedback: feedback, fullWidth: true };
        }
    </script>
</body>
</html>
